
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Accessing ITS_LIVE data via S3 bucket &#8212; Xarray workflow example - glacier surface velocities</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Individual glacier analysis 1" href="ind_glacier_analysis1.html" />
    <link rel="prev" title="Software and Data" href="software.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Xarray workflow example - glacier surface velocities</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Glacier surface velocity processing and analysis with xarray
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="still_to_do.html">
   To do for this book
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="software.html">
   Software and Data
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Accessing ITS_LIVE data via S3 bucket
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ind_glacier_analysis1.html">
   Individual glacier analysis 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="individual_glacier_analysis2.html">
   Individual glacier analysis 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="region_scale_glacier_analysis.html">
   Region-scale glacier analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Summary.html">
   Summary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="References.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/accessing_s3_data.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://e-marshall.github.io/mynewbook/intro.html"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://e-marshall.github.io/mynewbook/intro.html/issues/new?title=Issue%20on%20page%20%2Faccessing_s3_data.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#still-to-add">
   6/11 still to add
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finding-selecting-data">
   Finding / selecting data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#accessing-s3-data-from-python">
   Accessing s3 data from python
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#searching-catalog-of-s3-urls">
   Searching catalog of s3 urls
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#selecting-data-cubes-by-utm-zone">
   Selecting data cubes by UTM zone
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#selecting-granules-by-a-single-point">
   Selecting granules by a single point
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#trying-to-calc-show-seasonal-mean-velocities-but-not-working-yet">
     6/14 Trying to calc/show seasonal mean velocities but not working yet…
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculate-seasonal-means-using-groupby-of-subset-object">
     Calculate seasonal means using groupby of subset object
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Accessing ITS_LIVE data via S3 bucket</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#still-to-add">
   6/11 still to add
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finding-selecting-data">
   Finding / selecting data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#accessing-s3-data-from-python">
   Accessing s3 data from python
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#searching-catalog-of-s3-urls">
   Searching catalog of s3 urls
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#selecting-data-cubes-by-utm-zone">
   Selecting data cubes by UTM zone
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#selecting-granules-by-a-single-point">
   Selecting granules by a single point
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#trying-to-calc-show-seasonal-mean-velocities-but-not-working-yet">
     6/14 Trying to calc/show seasonal mean velocities but not working yet…
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculate-seasonal-means-using-groupby-of-subset-object">
     Calculate seasonal means using groupby of subset object
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="accessing-its-live-data-via-s3-bucket">
<h1>Accessing ITS_LIVE data via S3 bucket<a class="headerlink" href="#accessing-its-live-data-via-s3-bucket" title="Permalink to this headline">¶</a></h1>
<p>This notebook will demonstrate how to access cloud-hosted Inter-mission Time Series of Land Ice Velocity and Elevation (ITS_LIVE) data from AWS S3 buckets. Here you will find examples of how to successfully access cloud-hosted data as well as some common errors and issues you may run into along the way, what they mean, and how to resolve them.</p>
<p>Learning goals:</p>
<ul class="simple">
<li><p>accessing and inspecting data stored in s3 buckets</p></li>
</ul>
<div class="section" id="still-to-add">
<h2>6/11 still to add<a class="headerlink" href="#still-to-add" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>probably need to clean up the individual data cube builds at the beginning,  introduce read_in_s3() sooner and use that instead of by hand, add try: , except: to read_in_s3()</p></li>
<li><p>get_bbox() should show something about the granule id/location as a text printout ideally as well</p></li>
<li><p>maybe show a basic beginning example of looking at a single scene, plotting a few different time steps to show variability in coverage</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">rioxarray</span> <span class="k">as</span> <span class="nn">rxr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">mticker</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">from</span> <span class="nn">cartopy.mpl.gridliner</span> <span class="kn">import</span> <span class="n">LONGITUDE_FORMATTER</span><span class="p">,</span> <span class="n">LATITUDE_FORMATTER</span>
<span class="kn">import</span> <span class="nn">cartopy</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>
<span class="kn">import</span> <span class="nn">json</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="finding-selecting-data">
<h2>Finding / selecting data<a class="headerlink" href="#finding-selecting-data" title="Permalink to this headline">¶</a></h2>
<p>The ITS_LIVE project details a number of data access options on their <a class="reference external" href="https://its-live.jpl.nasa.gov/#access">website</a>. Here, we will be accessing ITS_LIVE data in the form of <code class="docutils literal notranslate"><span class="pre">zarr</span></code> data cubes that are stored in <strong>s3 buckets</strong> hosted by Amazon Web Services (AWS).</p>
<p>Let’s begin by looking at the <a class="reference external" href="https://its-live-data.s3.amazonaws.com/datacubes/catalog_v02.json">GeoJSON Data Cubes Catalog</a>.
This catalog contains spatial information and properties of ITS_LIVE data cubes as well as the url used to access each cube. Let’s take a look at the entry for a single data cube and the information that it contains:</p>
<p><img alt="itslive_info" src="_images/screengrab_itslive_catalog_entry.png" /></p>
<p>The top portion of the picture shows the spatial extent of the data cube in lat/lon units. Below that, we have properties such as the epsg code of the coordinate reference system, the spatial footprint in projected units and the url of the zarr object.</p>
<p>Let’s take a look at the url more in-depth:</p>
<p><img alt="itslive_url" src="_images/itslive_url.png" /></p>
<p>From this link we can see that we are looking at its_live data located in an s3 bucket hosted by amazon AWS. We cans see that we’re looking in the data cube directory and what seems to be version 2. The next bit gives us information about the global location of the cube (N40E080). The actual file name <code class="docutils literal notranslate"><span class="pre">ITS_LIVE_vel_EPSG32645_G0120_X250000_Y4750000.zarr</span></code> tells us that we are looking at ice velocity data (its_live also has elevation data), in the CRS associated with EPSG 32645 (this code indicates UTM zone 45N). X250000_Y4750000 tells us more about the spatial footprint of the datacube within the UTM zone.</p>
<p><strong>NOTE</strong>
This catalog provides http links to the zarr objects. To successfully point to the objects that we’re looking for in s3 buckets, we need to make a few changes to the links:</p>
<ul class="simple">
<li><p>replace ‘http’ with ‘s3’</p></li>
<li><p>delete ‘.s3.amazonaws.com’ </br></p></li>
</ul>
<p>so the correct url should read: </br></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>`s3://its-live-data/datacubes/v02/N40E080/ITS_LIVE_vel_EPSG32645_G0120_X250000_Y4750000.zarr`
</pre></div>
</div>
</div>
<div class="section" id="accessing-s3-data-from-python">
<h2>Accessing s3 data from python<a class="headerlink" href="#accessing-s3-data-from-python" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_'output_scroll' docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;output </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
               
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>output 0
output 1
output 2
output 3
output 4
output 5
output 6
output 7
output 8
output 9
output 10
output 11
output 12
output 13
output 14
output 15
output 16
output 17
output 18
output 19
output 20
output 21
output 22
output 23
output 24
output 25
output 26
output 27
output 28
output 29
output 30
output 31
output 32
output 33
output 34
output 35
output 36
output 37
output 38
output 39
output 40
output 41
output 42
output 43
output 44
output 45
output 46
output 47
output 48
output 49
output 50
output 51
output 52
output 53
output 54
output 55
output 56
output 57
output 58
output 59
output 60
output 61
output 62
output 63
output 64
output 65
output 66
output 67
output 68
output 69
output 70
output 71
output 72
output 73
output 74
output 75
output 76
output 77
output 78
output 79
output 80
output 81
output 82
output 83
output 84
output 85
output 86
output 87
output 88
output 89
output 90
output 91
output 92
output 93
output 94
output 95
output 96
output 97
output 98
output 99
</pre></div>
</div>
</div>
</div>
<p>We’ve found the url associated with the tile we want to access, let’s try to open the data cube using <code class="docutils literal notranslate"><span class="pre">xarray</span></code></p>
<div class="cell tag_'output_scroll' tag_'raises_exception' docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url_x25_y475</span> <span class="o">=</span> <span class="s1">&#39;s3://its-live-data/datacubes/v02/N40E080/ITS_LIVE_vel_EPSG32645_G0120_X250000_Y4750000.zarr&#39;</span>
<span class="n">data_cube_x25_y475</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">url_x25_y475</span><span class="p">,</span> <span class="n">engine</span> <span class="o">=</span> <span class="s1">&#39;zarr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">CancelledError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiohttp/connector.py:986,</span> in <span class="ni">TCPConnector._wrap_create_connection</span><span class="nt">(self, req, timeout, client_error, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">985</span>     <span class="k">async</span> <span class="k">with</span> <span class="n">ceil_timeout</span><span class="p">(</span><span class="n">timeout</span><span class="o">.</span><span class="n">sock_connect</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">986</span>         <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore[return-value]  # noqa</span>
<span class="g g-Whitespace">    </span><span class="mi">987</span> <span class="k">except</span> <span class="n">cert_errors</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/asyncio/base_events.py:1049,</span> in <span class="ni">BaseEventLoop.create_connection</span><span class="nt">(self, protocol_factory, host, port, ssl, family, proto, flags, sock, local_addr, server_hostname, ssl_handshake_timeout, happy_eyeballs_delay, interleave)</span>
<span class="g g-Whitespace">   </span><span class="mi">1048</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1049</span>     <span class="n">sock</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connect_sock</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1050</span>         <span class="n">exceptions</span><span class="p">,</span> <span class="n">addrinfo</span><span class="p">,</span> <span class="n">laddr_infos</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1051</span>     <span class="k">break</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/asyncio/base_events.py:960,</span> in <span class="ni">BaseEventLoop._connect_sock</span><span class="nt">(self, exceptions, addr_info, local_addr_infos)</span>
<span class="g g-Whitespace">    </span><span class="mi">959</span>         <span class="k">raise</span> <span class="n">my_exceptions</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">960</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock_connect</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">961</span> <span class="k">return</span> <span class="n">sock</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/asyncio/selector_events.py:499,</span> in <span class="ni">BaseSelectorEventLoop.sock_connect</span><span class="nt">(self, sock, address)</span>
<span class="g g-Whitespace">    </span><span class="mi">498</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sock_connect</span><span class="p">(</span><span class="n">fut</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">499</span> <span class="k">return</span> <span class="k">await</span> <span class="n">fut</span>

<span class="ne">CancelledError</span>: 

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">TimeoutError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiohttp/client.py:535,</span> in <span class="ni">ClientSession._request</span><span class="nt">(self, method, str_or_url, params, data, json, cookies, headers, skip_auto_headers, auth, allow_redirects, max_redirects, compress, chunked, expect100, raise_for_status, read_until_eof, proxy, proxy_auth, timeout, verify_ssl, fingerprint, ssl_context, ssl, proxy_headers, trace_request_ctx, read_bufsize)</span>
<span class="g g-Whitespace">    </span><span class="mi">534</span>         <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="ne">--&gt; </span><span class="mi">535</span>         <span class="n">conn</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">536</span>             <span class="n">req</span><span class="p">,</span> <span class="n">traces</span><span class="o">=</span><span class="n">traces</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">real_timeout</span>
<span class="g g-Whitespace">    </span><span class="mi">537</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">538</span> <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiohttp/connector.py:542,</span> in <span class="ni">BaseConnector.connect</span><span class="nt">(self, req, traces, timeout)</span>
<span class="g g-Whitespace">    </span><span class="mi">541</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">542</span>     <span class="n">proto</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_connection</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">traces</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">543</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiohttp/connector.py:907,</span> in <span class="ni">TCPConnector._create_connection</span><span class="nt">(self, req, traces, timeout)</span>
<span class="g g-Whitespace">    </span><span class="mi">906</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">907</span>     <span class="n">_</span><span class="p">,</span> <span class="n">proto</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_direct_connection</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">traces</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">909</span> <span class="k">return</span> <span class="n">proto</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiohttp/connector.py:1175,</span> in <span class="ni">TCPConnector._create_direct_connection</span><span class="nt">(self, req, traces, timeout, client_error)</span>
<span class="g g-Whitespace">   </span><span class="mi">1174</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1175</span>     <span class="n">transp</span><span class="p">,</span> <span class="n">proto</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_create_connection</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1176</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_factory</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1177</span>         <span class="n">host</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1178</span>         <span class="n">port</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1179</span>         <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1180</span>         <span class="n">ssl</span><span class="o">=</span><span class="n">sslcontext</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1181</span>         <span class="n">family</span><span class="o">=</span><span class="n">hinfo</span><span class="p">[</span><span class="s2">&quot;family&quot;</span><span class="p">],</span>
<span class="g g-Whitespace">   </span><span class="mi">1182</span>         <span class="n">proto</span><span class="o">=</span><span class="n">hinfo</span><span class="p">[</span><span class="s2">&quot;proto&quot;</span><span class="p">],</span>
<span class="g g-Whitespace">   </span><span class="mi">1183</span>         <span class="n">flags</span><span class="o">=</span><span class="n">hinfo</span><span class="p">[</span><span class="s2">&quot;flags&quot;</span><span class="p">],</span>
<span class="g g-Whitespace">   </span><span class="mi">1184</span>         <span class="n">server_hostname</span><span class="o">=</span><span class="n">hinfo</span><span class="p">[</span><span class="s2">&quot;hostname&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">sslcontext</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1185</span>         <span class="n">local_addr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_addr</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1186</span>         <span class="n">req</span><span class="o">=</span><span class="n">req</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1187</span>         <span class="n">client_error</span><span class="o">=</span><span class="n">client_error</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1188</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1189</span> <span class="k">except</span> <span class="n">ClientConnectorError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiohttp/connector.py:985,</span> in <span class="ni">TCPConnector._wrap_create_connection</span><span class="nt">(self, req, timeout, client_error, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">984</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">985</span>     <span class="k">async</span> <span class="k">with</span> <span class="n">ceil_timeout</span><span class="p">(</span><span class="n">timeout</span><span class="o">.</span><span class="n">sock_connect</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">986</span>         <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore[return-value]  # noqa</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/async_timeout/__init__.py:129,</span> in <span class="ni">Timeout.__aexit__</span><span class="nt">(self, exc_type, exc_val, exc_tb)</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span> <span class="k">async</span> <span class="k">def</span> <span class="fm">__aexit__</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>     <span class="n">exc_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span>     <span class="n">exc_val</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">127</span>     <span class="n">exc_tb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracebackType</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">128</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="ne">--&gt; </span><span class="mi">129</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_do_exit</span><span class="p">(</span><span class="n">exc_type</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span>     <span class="k">return</span> <span class="kc">None</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/async_timeout/__init__.py:212,</span> in <span class="ni">Timeout._do_exit</span><span class="nt">(self, exc_type)</span>
<span class="g g-Whitespace">    </span><span class="mi">211</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_timeout_handler</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">--&gt; </span><span class="mi">212</span>     <span class="k">raise</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span>
<span class="g g-Whitespace">    </span><span class="mi">213</span> <span class="c1"># timeout has not expired</span>

<span class="ne">TimeoutError</span>: 

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">ServerTimeoutError</span><span class="g g-Whitespace">                        </span>Traceback (most recent call last)
<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiobotocore/httpsession.py:178,</span> in <span class="ni">AIOHTTPSession.send</span><span class="nt">(self, request)</span>
<span class="g g-Whitespace">    </span><span class="mi">177</span> <span class="n">url</span> <span class="o">=</span> <span class="n">URL</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">encoded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">178</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">179</span>     <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers_</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="n">proxy_url</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">180</span>     <span class="n">proxy_headers</span><span class="o">=</span><span class="n">proxy_headers</span>
<span class="g g-Whitespace">    </span><span class="mi">181</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">183</span> <span class="n">http_response</span> <span class="o">=</span> <span class="n">aiobotocore</span><span class="o">.</span><span class="n">awsrequest</span><span class="o">.</span><span class="n">AioAWSResponse</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">184</span>     <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span>     <span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span>     <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">187</span>     <span class="n">response</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span> <span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiohttp/client.py:539,</span> in <span class="ni">ClientSession._request</span><span class="nt">(self, method, str_or_url, params, data, json, cookies, headers, skip_auto_headers, auth, allow_redirects, max_redirects, compress, chunked, expect100, raise_for_status, read_until_eof, proxy, proxy_auth, timeout, verify_ssl, fingerprint, ssl_context, ssl, proxy_headers, trace_request_ctx, read_bufsize)</span>
<span class="g g-Whitespace">    </span><span class="mi">538</span> <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">539</span>     <span class="k">raise</span> <span class="n">ServerTimeoutError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">540</span>         <span class="s2">&quot;Connection timeout &quot;</span> <span class="s2">&quot;to host </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">541</span>     <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
<span class="g g-Whitespace">    </span><span class="mi">543</span> <span class="k">assert</span> <span class="n">conn</span><span class="o">.</span><span class="n">transport</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="ne">ServerTimeoutError</span>: Connection timeout to host http://169.254.169.254/latest/api/token

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">ConnectTimeoutError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">Input In [3],</span> in <span class="ni">&lt;cell line: 2&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">url_x25_y475</span> <span class="o">=</span> <span class="s1">&#39;s3://its-live-data/datacubes/v02/N40E080/ITS_LIVE_vel_EPSG32645_G0120_X250000_Y4750000.zarr&#39;</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">data_cube_x25_y475</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">url_x25_y475</span><span class="p">,</span> <span class="n">engine</span> <span class="o">=</span> <span class="s1">&#39;zarr&#39;</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/xarray/backends/api.py:495,</span> in <span class="ni">open_dataset</span><span class="nt">(filename_or_obj, engine, chunks, cache, decode_cf, mask_and_scale, decode_times, decode_timedelta, use_cftime, concat_characters, decode_coords, drop_variables, backend_kwargs, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span> <span class="n">decoders</span> <span class="o">=</span> <span class="n">_resolve_decoders_kwargs</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">484</span>     <span class="n">decode_cf</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">485</span>     <span class="n">open_backend_dataset_parameters</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">open_dataset_parameters</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">491</span>     <span class="n">decode_coords</span><span class="o">=</span><span class="n">decode_coords</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">492</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">494</span> <span class="n">overwrite_encoded_chunks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;overwrite_encoded_chunks&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">495</span> <span class="n">backend_ds</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">496</span>     <span class="n">filename_or_obj</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">497</span>     <span class="n">drop_variables</span><span class="o">=</span><span class="n">drop_variables</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">498</span>     <span class="o">**</span><span class="n">decoders</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">499</span>     <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">500</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">501</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">_dataset_from_backend_dataset</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">502</span>     <span class="n">backend_ds</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">503</span>     <span class="n">filename_or_obj</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">510</span>     <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">511</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">512</span> <span class="k">return</span> <span class="n">ds</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/xarray/backends/zarr.py:800,</span> in <span class="ni">ZarrBackendEntrypoint.open_dataset</span><span class="nt">(self, filename_or_obj, mask_and_scale, decode_times, concat_characters, decode_coords, drop_variables, use_cftime, decode_timedelta, group, mode, synchronizer, consolidated, chunk_store, storage_options, stacklevel)</span>
<span class="g g-Whitespace">    </span><span class="mi">780</span> <span class="k">def</span> <span class="nf">open_dataset</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">781</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">782</span>     <span class="n">filename_or_obj</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">796</span>     <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">797</span> <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">799</span>     <span class="n">filename_or_obj</span> <span class="o">=</span> <span class="n">_normalize_path</span><span class="p">(</span><span class="n">filename_or_obj</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">800</span>     <span class="n">store</span> <span class="o">=</span> <span class="n">ZarrStore</span><span class="o">.</span><span class="n">open_group</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">801</span>         <span class="n">filename_or_obj</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">802</span>         <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">803</span>         <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">804</span>         <span class="n">synchronizer</span><span class="o">=</span><span class="n">synchronizer</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">805</span>         <span class="n">consolidated</span><span class="o">=</span><span class="n">consolidated</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">806</span>         <span class="n">consolidate_on_close</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">807</span>         <span class="n">chunk_store</span><span class="o">=</span><span class="n">chunk_store</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">808</span>         <span class="n">storage_options</span><span class="o">=</span><span class="n">storage_options</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">809</span>         <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">810</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span>     <span class="n">store_entrypoint</span> <span class="o">=</span> <span class="n">StoreBackendEntrypoint</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="k">with</span> <span class="n">close_on_error</span><span class="p">(</span><span class="n">store</span><span class="p">):</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/xarray/backends/zarr.py:348,</span> in <span class="ni">ZarrStore.open_group</span><span class="nt">(cls, store, mode, synchronizer, group, consolidated, consolidate_on_close, chunk_store, storage_options, append_dim, write_region, safe_chunks, stacklevel)</span>
<span class="g g-Whitespace">    </span><span class="mi">346</span> <span class="k">if</span> <span class="n">consolidated</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">347</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">348</span>         <span class="n">zarr_group</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open_consolidated</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="o">**</span><span class="n">open_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">349</span>     <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">350</span>         <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">351</span>             <span class="s2">&quot;Failed to open Zarr store with consolidated metadata, &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">352</span>             <span class="s2">&quot;falling back to try reading non-consolidated metadata. &quot;</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">363</span>             <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">364</span>         <span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/zarr/convenience.py:1181,</span> in <span class="ni">open_consolidated</span><span class="nt">(store, metadata_key, mode, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1178</span> <span class="kn">from</span> <span class="nn">.storage</span> <span class="kn">import</span> <span class="n">ConsolidatedMetadataStore</span>
<span class="g g-Whitespace">   </span><span class="mi">1180</span> <span class="c1"># normalize parameters</span>
<span class="ne">-&gt; </span><span class="mi">1181</span> <span class="n">store</span> <span class="o">=</span> <span class="n">normalize_store_arg</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1182</span> <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">}:</span>
<span class="g g-Whitespace">   </span><span class="mi">1183</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;invalid mode, expected either &#39;r&#39; or &#39;r+&#39;; found </span><span class="si">{!r}</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1184</span>                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/zarr/storage.py:114,</span> in <span class="ni">normalize_store_arg</span><span class="nt">(store, storage_options, mode)</span>
<span class="g g-Whitespace">    </span><span class="mi">112</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">113</span>     <span class="k">if</span> <span class="s2">&quot;://&quot;</span> <span class="ow">in</span> <span class="n">store</span> <span class="ow">or</span> <span class="s2">&quot;::&quot;</span> <span class="ow">in</span> <span class="n">store</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">114</span>         <span class="k">return</span> <span class="n">FSStore</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="n">storage_options</span> <span class="ow">or</span> <span class="p">{}))</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span>     <span class="k">elif</span> <span class="n">storage_options</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">116</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;storage_options passed with non-fsspec path&quot;</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/zarr/storage.py:1140,</span> in <span class="ni">FSStore.__init__</span><span class="nt">(self, url, normalize_keys, key_separator, mode, exceptions, dimension_separator, **storage_options)</span>
<span class="g g-Whitespace">   </span><span class="mi">1138</span> <span class="c1"># Pass attributes to array creation</span>
<span class="g g-Whitespace">   </span><span class="mi">1139</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimension_separator</span> <span class="o">=</span> <span class="n">dimension_separator</span>
<span class="ne">-&gt; </span><span class="mi">1140</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1141</span>     <span class="k">raise</span> <span class="n">FSPathExistNotDir</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/fsspec/asyn.py:86,</span> in <span class="ni">sync_wrapper.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">83</span> <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">84</span> <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">85</span>     <span class="bp">self</span> <span class="o">=</span> <span class="n">obj</span> <span class="ow">or</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="ne">---&gt; </span><span class="mi">86</span>     <span class="k">return</span> <span class="n">sync</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/fsspec/asyn.py:66,</span> in <span class="ni">sync</span><span class="nt">(loop, func, timeout, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span>     <span class="k">raise</span> <span class="n">FSTimeoutError</span> <span class="kn">from</span> <span class="nn">return_result</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">return_result</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">66</span>     <span class="k">raise</span> <span class="n">return_result</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span>     <span class="k">return</span> <span class="n">return_result</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/fsspec/asyn.py:26,</span> in <span class="ni">_runner</span><span class="nt">(event, coro, result, timeout)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>     <span class="n">coro</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">coro</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">26</span>     <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span>     <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ex</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/s3fs/core.py:888,</span> in <span class="ni">S3FileSystem._exists</span><span class="nt">(self, path)</span>
<span class="g g-Whitespace">    </span><span class="mi">886</span>     <span class="k">return</span> <span class="kc">False</span>
<span class="g g-Whitespace">    </span><span class="mi">887</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">888</span>     <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">version_id</span><span class="o">=</span><span class="n">version_id</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">889</span>     <span class="k">return</span> <span class="kc">True</span>
<span class="g g-Whitespace">    </span><span class="mi">890</span> <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/s3fs/core.py:1140,</span> in <span class="ni">S3FileSystem._info</span><span class="nt">(self, path, bucket, key, refresh, version_id)</span>
<span class="g g-Whitespace">   </span><span class="mi">1138</span> <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1139</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1140</span>         <span class="n">out</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_s3</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1141</span>             <span class="s2">&quot;head_object&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1142</span>             <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1143</span>             <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1144</span>             <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1145</span>             <span class="o">**</span><span class="n">version_id_kw</span><span class="p">(</span><span class="n">version_id</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1146</span>             <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">req_kw</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1147</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1148</span>         <span class="k">return</span> <span class="p">{</span>
<span class="g g-Whitespace">   </span><span class="mi">1149</span>             <span class="s2">&quot;ETag&quot;</span><span class="p">:</span> <span class="n">out</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ETag&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1150</span>             <span class="s2">&quot;LastModified&quot;</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">&quot;LastModified&quot;</span><span class="p">],</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1156</span>             <span class="s2">&quot;ContentType&quot;</span><span class="p">:</span> <span class="n">out</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ContentType&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1157</span>         <span class="p">}</span>
<span class="g g-Whitespace">   </span><span class="mi">1158</span>     <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/s3fs/core.py:325,</span> in <span class="ni">S3FileSystem._call_s3</span><span class="nt">(self, method, *akwarglist, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">324</span> <span class="k">async</span> <span class="k">def</span> <span class="nf">_call_s3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">akwarglist</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">325</span>     <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_session</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">326</span>     <span class="n">s3</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Bucket&quot;</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span>     <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">s3</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/s3fs/core.py:473,</span> in <span class="ni">S3FileSystem.set_session</span><span class="nt">(self, refresh, kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">469</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">470</span>     <span class="n">s3creator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">471</span>         <span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">conf</span><span class="p">,</span> <span class="o">**</span><span class="n">init_kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">client_kwargs</span>
<span class="g g-Whitespace">    </span><span class="mi">472</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">473</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_s3</span> <span class="o">=</span> <span class="k">await</span> <span class="n">s3creator</span><span class="o">.</span><span class="fm">__aenter__</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">475</span> <span class="bp">self</span><span class="o">.</span><span class="n">_s3creator</span> <span class="o">=</span> <span class="n">s3creator</span>
<span class="g g-Whitespace">    </span><span class="mi">476</span> <span class="c1"># the following actually closes the aiohttp connection; use of privates</span>
<span class="g g-Whitespace">    </span><span class="mi">477</span> <span class="c1"># might break in the future, would cause exception at gc time</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiobotocore/session.py:22,</span> in <span class="ni">ClientCreatorContext.__aenter__</span><span class="nt">(self)</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="k">async</span> <span class="k">def</span> <span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AioBaseClient</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">22</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coro</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>     <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="fm">__aenter__</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiobotocore/session.py:102,</span> in <span class="ni">AioSession._create_client</span><span class="nt">(self, service_name, region_name, api_version, use_ssl, verify, endpoint_url, aws_access_key_id, aws_secret_access_key, aws_session_token, config)</span>
<span class="g g-Whitespace">     </span><span class="mi">97</span>     <span class="k">raise</span> <span class="n">PartialCredentialsError</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">98</span>         <span class="n">provider</span><span class="o">=</span><span class="s1">&#39;explicit&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">99</span>         <span class="n">cred_var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_missing_cred_vars</span><span class="p">(</span><span class="n">aws_access_key_id</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span>                                          <span class="n">aws_secret_access_key</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">101</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">102</span>     <span class="n">credentials</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_credentials</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">103</span> <span class="n">endpoint_resolver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_component</span><span class="p">(</span><span class="s1">&#39;endpoint_resolver&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">104</span> <span class="n">exceptions_factory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_component</span><span class="p">(</span><span class="s1">&#39;exceptions_factory&#39;</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiobotocore/session.py:133,</span> in <span class="ni">AioSession.get_credentials</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">131</span> <span class="k">async</span> <span class="k">def</span> <span class="nf">get_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_credentials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">133</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_credentials</span> <span class="o">=</span> <span class="k">await</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span>             <span class="s1">&#39;credential_provider&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">load_credentials</span><span class="p">())</span>
<span class="g g-Whitespace">    </span><span class="mi">135</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_credentials</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiobotocore/credentials.py:814,</span> in <span class="ni">AioCredentialResolver.load_credentials</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> <span class="k">for</span> <span class="n">provider</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">providers</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Looking for credentials via: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">provider</span><span class="o">.</span><span class="n">METHOD</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">814</span>     <span class="n">creds</span> <span class="o">=</span> <span class="k">await</span> <span class="n">provider</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">815</span>     <span class="k">if</span> <span class="n">creds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">816</span>         <span class="k">return</span> <span class="n">creds</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiobotocore/credentials.py:486,</span> in <span class="ni">AioInstanceMetadataProvider.load</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">484</span> <span class="k">async</span> <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">485</span>     <span class="n">fetcher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_role_fetcher</span>
<span class="ne">--&gt; </span><span class="mi">486</span>     <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fetcher</span><span class="o">.</span><span class="n">retrieve_iam_role_credentials</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">487</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">metadata</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">488</span>         <span class="k">return</span> <span class="kc">None</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiobotocore/utils.py:175,</span> in <span class="ni">AioInstanceMetadataFetcher.retrieve_iam_role_credentials</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">173</span> <span class="k">async</span> <span class="k">def</span> <span class="nf">retrieve_iam_role_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">175</span>         <span class="n">token</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_metadata_token</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">176</span>         <span class="n">role_name</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_iam_role</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">177</span>         <span class="n">credentials</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_credentials</span><span class="p">(</span><span class="n">role_name</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiobotocore/utils.py:88,</span> in <span class="ni">AioIMDSFetcher._fetch_metadata_token</span><span class="nt">(self)</span>
<span class="g g-Whitespace">     </span><span class="mi">86</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_attempts</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">87</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">88</span>         <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">prepare</span><span class="p">())</span>
<span class="g g-Whitespace">     </span><span class="mi">89</span>         <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">90</span>             <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

<span class="nn">File ~/miniconda3/envs/mynewbook/lib/python3.10/site-packages/aiobotocore/httpsession.py:210,</span> in <span class="ni">AIOHTTPSession.send</span><span class="nt">(self, request)</span>
<span class="g g-Whitespace">    </span><span class="mi">208</span> <span class="k">except</span> <span class="n">ServerTimeoutError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span>     <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">210</span>         <span class="k">raise</span> <span class="n">ConnectTimeoutError</span><span class="p">(</span><span class="n">endpoint_url</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">211</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">212</span>         <span class="k">raise</span> <span class="n">ReadTimeoutError</span><span class="p">(</span><span class="n">endpoint_url</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>

<span class="ne">ConnectTimeoutError</span>: Connect timeout on endpoint URL: &quot;http://169.254.169.254/latest/api/token&quot;
</pre></div>
</div>
</div>
</div>
<p>As you can see, this doesn’t quite work. We need to specify a bit more information for xarray to be able to access and load the data cube:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_cube_x25_y475</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">url_x25_y475</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span> <span class="s1">&#39;zarr&#39;</span><span class="p">,</span>
                                    <span class="n">storage_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;anon&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>This one worked! Let’s stop here and define a function that we can use for a quick inspection of this data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_bbox_single</span><span class="p">(</span><span class="n">input_xr</span><span class="p">):</span>
    
    <span class="sd">&#39;&#39;&#39;Takes input xr object (from itslive data cube), plots a quick map of the footprint. </span>
<span class="sd">    currently only working for granules in crs epsg 32645&#39;&#39;&#39;</span>

    <span class="n">xmin</span> <span class="o">=</span> <span class="n">input_xr</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">input_xr</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">ymin</span> <span class="o">=</span> <span class="n">input_xr</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">input_xr</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">pts_ls</span> <span class="o">=</span> <span class="p">[(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">),</span> <span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">),(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">)]</span>

    <span class="c1">#print(input_xr.mapping.spatial_epsg)</span>
    <span class="c1">#print(f&quot;epsg:{input_xr.mapping.spatial_epsg}&quot;)</span>
    <span class="n">crs</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;epsg:</span><span class="si">{</span><span class="n">input_xr</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">spatial_epsg</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="c1">#crs = {&#39;init&#39;:f&#39;epsg:{input_xr.mapping.spatial_epsg}&#39;}</span>
    <span class="c1">#crs = &#39;epsg:32645&#39;</span>
    <span class="c1">#print(crs)</span>

    <span class="n">polygon_geom</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">pts_ls</span><span class="p">)</span>
    <span class="n">polygon</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">polygon_geom</span><span class="p">])</span> 
    <span class="n">polygon</span> <span class="o">=</span> <span class="n">polygon</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">)</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="n">polygon</span><span class="o">.</span><span class="n">total_bounds</span>
    <span class="n">bounds_format</span> <span class="o">=</span> <span class="p">[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">15</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">15</span><span class="p">]</span>

    <span class="n">states_provinces</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
        <span class="n">category</span> <span class="o">=</span> <span class="s1">&#39;cultural&#39;</span><span class="p">,</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;admin_1_states_provinces_lines&#39;</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;50m&#39;</span><span class="p">,</span>
        <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span>
    <span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">states_provinces</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">bounds_format</span><span class="p">,</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="n">polygon</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s also write a quick function for reading in s3 objects from http urls. This will come in handy when we’re trying to test multiple urls</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_in_s3</span><span class="p">(</span><span class="n">http_url</span><span class="p">):</span>
    <span class="n">s3_url</span> <span class="o">=</span> <span class="n">http_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">,</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
    <span class="n">s3_url</span> <span class="o">=</span> <span class="n">s3_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.s3.amazonaws.com&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">datacube</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">s3_url</span><span class="p">,</span> <span class="n">engine</span> <span class="o">=</span> <span class="s1">&#39;zarr&#39;</span><span class="p">,</span>
                                <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;anon&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
                                <span class="n">chunks</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">datacube</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s take a look at the cube we’ve already read in:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_bbox_single</span><span class="p">(</span><span class="n">data_cube_x25_y475</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can see where this granule lies. Let’s try another url:</p>
<div class="cell tag_&quot;output_scroll&quot; tag_&quot;raises_exception&quot; docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#this url doen&#39;st work</span>
<span class="n">url_x35_y305</span> <span class="o">=</span> <span class="s1">&#39;http://its-live-data.s3.amazonaws.com/datacubes/v02/N20E080/ITS_LIVE_vel_EPSG32645_G0120_X350000_Y3350000.zarr&#39;</span>
<span class="n">dc_x35_y305</span> <span class="o">=</span> <span class="n">read_in_s3</span><span class="p">(</span><span class="n">url_x35_y305</span><span class="p">)</span>
                                    <span class="c1">#engine= &#39;zarr&#39;,</span>
                                    <span class="c1">#storage_options = {&#39;anon&#39;:True})</span>
</pre></div>
</div>
</div>
</div>
<p>This link doesn’t work. From the error we’re getting, it looks like it’s not working because the zarr file isn’t in the location that we’re pointing to with the url we supply. As cloud-based datasets are developed and maintained, the locations of specific objects will change and sometimes metadata doesn’t always catch up, so this may be an error you’ll encounter more than once.</p>
<p>Let’s try another url:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url_x35_y315</span> <span class="o">=</span> <span class="s1">&#39;http://its-live-data.s3.amazonaws.com/datacubes/v02/N20E080/ITS_LIVE_vel_EPSG32645_G0120_X350000_Y3150000.zarr&#39;</span>

<span class="n">dc_x35_y315</span> <span class="o">=</span> <span class="n">read_in_s3</span><span class="p">(</span><span class="n">url_x35_y315</span><span class="p">)</span>
                           
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="searching-catalog-of-s3-urls">
<h2>Searching catalog of s3 urls<a class="headerlink" href="#searching-catalog-of-s3-urls" title="Permalink to this headline">¶</a></h2>
<p>We know that some zarr objects are located at the supplied urls but that some aren’t. We have the entire catalog, but it would be a pain to look through each of those urls individually so let’s write a function to find out which urls are working and which arent</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;https://its-live-data.s3.amazonaws.com/datacubes/catalog_v02.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">url</span><span class="p">:</span>
    <span class="n">itslive_catalog</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
<span class="n">itslive_catalog</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>In python, the json object has the form of nested dictionaries that contain information about all of the its_live datacubes. Here we’ll show two options for filtering the catalog: one for selecting granules that contain a specific point and a second that returns all granules within a single UTM zone (specified by epsg code). This will let us take stock of the spatial coverage of data cubes located at <strong>working urls</strong> within a certain UTM zone. You could easily tewak this function (or write your own!) to select granules based on different properties. Play around with the <code class="docutils literal notranslate"><span class="pre">itslive_catalog</span></code> object to become more familiar with the data it contains and different options for indexing.</p>
</div>
<div class="section" id="selecting-data-cubes-by-utm-zone">
<h2>Selecting data cubes by UTM zone<a class="headerlink" href="#selecting-data-cubes-by-utm-zone" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_granules_by_epsg</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">input_epsg</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;this function takes a dictionary that is a representation of itslive data cube geojson catalog as well as an </span>
<span class="sd">    epsg code. it makes an intermediate object that is a list of all s3 urls for that utm region/epsg code. it</span>
<span class="sd">    then tried to open each zarr url as an xarray dataset and returns a list of the ones that are able to be opened</span>
<span class="sd">    successuflly (ie. the zarr file exists at the s3 url). each element of the return list is an xr dataset&#39;&#39;&#39;</span>
    
    <span class="n">epsg_ls</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="k">for</span> <span class="n">granule</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">])):</span>
        
        <span class="k">if</span> <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="n">granule</span><span class="p">][</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;data_epsg&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">input_epsg</span><span class="p">:</span>
            
            <span class="n">http_url</span> <span class="o">=</span> <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="n">granule</span><span class="p">][</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;zarr_url&#39;</span><span class="p">]</span>
            <span class="n">s3_url</span> <span class="o">=</span> <span class="n">http_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;s3&#39;</span><span class="p">)</span>
            <span class="n">s3_url</span> <span class="o">=</span> <span class="n">s3_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.s3.amazonaws.com&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">epsg_ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s3_url</span><span class="p">)</span>
     
    <span class="n">datacube_ls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">epsg_ls</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#datacube_ls.append(read_in_s3(epsg_ls[element]))</span>
            <span class="n">datacube_ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">epsg_ls</span><span class="p">[</span><span class="n">element</span><span class="p">],</span> <span class="n">engine</span> <span class="o">=</span> <span class="s1">&#39;zarr&#39;</span><span class="p">,</span>
                                <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;anon&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nothing there ¯\_(ツ)_/¯ &#39;</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">datacube_ls</span>
   
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">granule_ls_32645</span> <span class="o">=</span> <span class="n">find_granules_by_epsg</span><span class="p">(</span><span class="n">itslive_catalog</span><span class="p">,</span> <span class="s1">&#39;EPSG:32645&#39;</span><span class="p">)</span>
<span class="n">granule_ls_32645</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>This function returns a list of xarray objects that correspond to all of the zarr urls for that region that were able to be successfully accessed.</p>
<p>Let’s write a function to visualize the coverage:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_bbox_group</span><span class="p">(</span><span class="n">input_ls</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">]):</span> 
    
    <span class="sd">&#39;&#39;&#39;plots the spatial extents of a list of datacubes&#39;&#39;&#39;</span>
    
    <span class="n">poly_ls</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">xr_obj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">input_ls</span><span class="p">)):</span>
        <span class="sd">&#39;&#39;&#39;Takes input xr object (from itslive data cube), plots a quick map of the footprint. </span>
<span class="sd">        currently only working for granules in crs epsg 32645&#39;&#39;&#39;</span>

        <span class="n">xmin</span> <span class="o">=</span> <span class="n">input_ls</span><span class="p">[</span><span class="n">xr_obj</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">input_ls</span><span class="p">[</span><span class="n">xr_obj</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">input_ls</span><span class="p">[</span><span class="n">xr_obj</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">input_ls</span><span class="p">[</span><span class="n">xr_obj</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">pts_ls</span> <span class="o">=</span> <span class="p">[(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">),</span> <span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">),(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">)]</span>

        
        <span class="n">crs</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;epsg:</span><span class="si">{</span><span class="n">input_ls</span><span class="p">[</span><span class="n">xr_obj</span><span class="p">]</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">spatial_epsg</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1">#should be format: &#39;epsg:32645&#39;</span>
        <span class="c1">#print(crs)</span>

        <span class="n">polygon_geom</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">pts_ls</span><span class="p">)</span>
        <span class="n">polygon</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">polygon_geom</span><span class="p">])</span> 
        <span class="n">polygon</span> <span class="o">=</span> <span class="n">polygon</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">)</span>
        <span class="n">poly_ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

    <span class="n">bounds_format</span> <span class="o">=</span> <span class="p">[</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">bounds_format</span><span class="p">,</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    
    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">left_labels</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">xlines</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">xlocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">([</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">xlabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">}</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">xlabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">poly_ls</span><span class="p">)):</span>
            
        <span class="c1">#polygon.plot(ax=ax, facecolor = &#39;none&#39;, edgecolor=&#39;red&#39;, lw=1.)</span>
        <span class="n">poly_ls</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_bbox_group</span><span class="p">(</span><span class="n">granule_ls_32645</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s take a closer look at the region of interest, we can do that by specifying bounds when we call the function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_bbox_group</span><span class="p">(</span><span class="n">granule_ls_32645</span><span class="p">,</span> <span class="p">[</span><span class="mi">70</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="selecting-granules-by-a-single-point">
<h2>Selecting granules by a single point<a class="headerlink" href="#selecting-granules-by-a-single-point" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#might need to add a try, except statement to this in case the url doesn&#39;t work, or maybe to read_in_s3 fn...</span>
<span class="k">def</span> <span class="nf">find_granule_by_point</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">input_point</span><span class="p">):</span> <span class="c1">#[lon,lat]</span>
    <span class="sd">&#39;&#39;&#39;Takes an inputu dictionary (a geojson catalog) and a point to represent AOI.</span>
<span class="sd">    this returns a list of the s3 urls corresponding to zarr datacubes whose footprint covers the AOI&#39;&#39;&#39;</span>
    <span class="c1">#print([input_points][0])</span>
    
    <span class="n">target_granule_urls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">#Point(coord[0], coord[1])</span>
    <span class="c1">#print(input_point[0])</span>
    <span class="c1">#print(input_point[1])</span>
    <span class="n">point_geom</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">input_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1">#print(point_geom)</span>
    <span class="n">point_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">,</span> <span class="n">geometry</span> <span class="o">=</span> <span class="p">[</span><span class="n">point_geom</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">granule</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">])):</span>
        
        <span class="c1">#print(&#39;tick&#39;)</span>
        <span class="n">bbox_ls</span> <span class="o">=</span> <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="n">granule</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bbox_geom</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">bbox_ls</span><span class="p">)</span>
        <span class="n">bbox_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">,</span> <span class="n">geometry</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox_geom</span><span class="p">])</span>
        
        <span class="c1">#if poly_gdf.contains(points1_ls[poly]).all() == True:</span>

        <span class="k">if</span> <span class="n">bbox_gdf</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">point_gdf</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1">#print(&#39;yes&#39;)</span>
            <span class="n">target_granule_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="n">granule</span><span class="p">][</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;zarr_url&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="c1">#print(&#39;no&#39;)</span>
    <span class="k">return</span> <span class="n">target_granule_urls</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nepal_url_ls</span> <span class="o">=</span> <span class="n">find_granule_by_point</span><span class="p">(</span><span class="n">itslive_catalog</span><span class="p">,</span> <span class="p">[</span><span class="mf">86.7</span><span class="p">,</span> <span class="mf">28.07</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Great, this function returned a single url corresponding to the data cube covering the point we supplied</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nepal_url_ls</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s use the <code class="docutils literal notranslate"><span class="pre">read_in_s3</span></code> function we defined to open the datacube as an <code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nepal_dc</span> <span class="o">=</span> <span class="n">read_in_s3</span><span class="p">(</span><span class="n">nepal_url_ls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>and then the <code class="docutils literal notranslate"><span class="pre">get_bbox_single</span></code> function to take a look at the footprint:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_bbox_single</span><span class="p">(</span><span class="n">nepal_dc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Great, now we know how to access the its_live data cubes for a given region as well as at a specific point</p>
<div class="section" id="trying-to-calc-show-seasonal-mean-velocities-but-not-working-yet">
<h3>6/14 Trying to calc/show seasonal mean velocities but not working yet…<a class="headerlink" href="#trying-to-calc-show-seasonal-mean-velocities-but-not-working-yet" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#make subset of just a few time steps to start</span>
<span class="n">nepal_sub</span> <span class="o">=</span> <span class="n">nepal_dc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">mid_date</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#explore dt accessors a bit</span>
<span class="n">nepal_sub</span><span class="o">.</span><span class="n">mid_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="calculate-seasonal-means-using-groupby-of-subset-object">
<h3>Calculate seasonal means using groupby of subset object<a class="headerlink" href="#calculate-seasonal-means-using-groupby-of-subset-object" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nepal_sub</span>

<span class="c1">#subset the vars we&#39;re interested in, remove string</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#first, split the data into groups, here that is seasons</span>
<span class="n">season_gb</span> <span class="o">=</span> <span class="n">nepal_sub</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">nepal_sub</span><span class="o">.</span><span class="n">mid_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">season</span><span class="p">)</span>
<span class="n">season_gb</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#define a function to apply to each group</span>
<span class="k">def</span> <span class="nf">middate_mean</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;mid_date&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#use map to apply function to groups</span>

<span class="n">season_gb</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "mynewbook"
        },
        kernelOptions: {
            kernelName: "mynewbook",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'mynewbook'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="software.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Software and Data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="ind_glacier_analysis1.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Individual glacier analysis 1</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By emma marshall<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>